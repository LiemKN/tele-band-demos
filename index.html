<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <script src="https://prod.flat-cdn.com/embed-js/v1.3.0/embed.min.js"></script>
  <title>Flat.io File type demo</title>
</head>

<body>
  <header>
    <h1>Flat.io File Type Rendering Demo</h1>
  </header>
  <div class="demo-container">
    <div class="lefter"></div>
    <div class="chester">
      <h3 class="edit">Edit the score then click one of the buttons render your desired file type below!</h3>
      <div id="edit-container"></div>
      <div class="button-container">
        <button class="png" onclick="loadPNG()">PNG</button>
        <button class="png" onclick="loadXML()">Music XML/MXL</button>
        <button class="png" onclick="loadJSON()">JSON</button>
        <button class="png" onclick="loadMIDI()">MIDI</button>
        <button class="png" onclick="loadMeta()">Score Meta</button>
      </div>
      <h3 id="result-header">Result:</h3>
      <div id="result-container"><img id="img" src="" alt=""></div>
    </div>
    <div class="righter"></div>
  </div>
</body>

<script>
  var editContainer = document.getElementById("edit-container");
  var edit = new Flat.Embed(editContainer, {
    "width": "100%",
    "height": "450",
    "score": "60a51bf21c50d81fb20e3527",
    "embedParams": {
      "mode": "edit",
      "appId": "60a51c906bcde01fc75a3ad0",
      "sharingKey": "d1ec638f0eade5a3a2ad3bcadce9b7664273a7b2352844458385fe7d8d20238620f61a668ee3055d2d3177bd9282fcc88c692ea81e6668ae1610b37cde6aae93"
    },
  });

  var resultContainer = document.getElementById("result-container");
  var resultEmbed = new Flat.Embed(resultContainer, {
    "width": "100%",
    "height": "300",
    "embedParams": {
      "appId": "60a51c906bcde01fc75a3ad0",
    },
  });

  let resultHeader = document.getElementById('result-header')

  async function loadPNG() {
    let png = await edit.getPNG({
      result: 'dataURL',
      // layout: 'layout',
      // dpi: 300
    })
    resultHeader.innerHTML = 'Rendering PNG:'
    const img = document.getElementById('img')
    img.src = png
  }

  async function loadXML() {
    let buffer = await edit.getMusicXML({ compressed: true })
    const img = document.getElementById('img')
    resultHeader.innerHTML = 'Rendering MXL (compressed):'
    img.src = ''
    resultEmbed.loadMusicXML(buffer);
  }

  async function loadJSON() {
    let data = await edit.getJSON()
    const img = document.getElementById('img')
    resultHeader.innerHTML = 'Rendering JSON:'
    img.src = ''
    resultEmbed.loadJSON(data)
  }

  async function loadMIDI() {
    let midi = await edit.getMIDI()
    console.log(midi)
    alert('not working yet!')
  }

  async function loadMeta() {
    alert('not working yet!')
  }
</script>

</html>